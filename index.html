<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Widget with Debugging</title>
</head>
<body>
  <div id="countdown">Preparing to submit...</div>
  <script>
    // Helper function for logging debug messages
    function logDebug(message) {
      console.log(`[Widget Debug]: ${message}`);
    }

    document.addEventListener("DOMContentLoaded", function () {
      let countdown = 3; // Countdown seconds
      const countdownElement = document.getElementById("countdown");

      // Log that the widget has loaded
      logDebug("Widget loaded successfully.");

      // Start the countdown
      const interval = setInterval(() => {
        logDebug(`Countdown: ${countdown} seconds remaining.`);
        countdownElement.textContent = `Submitting in ${countdown} seconds...`;
        countdown--;

        if (countdown < 0) {
          clearInterval(interval);

          // Attempt to notify parent form to submit
          try {
            logDebug("Attempting to send postMessage to parent...");
            window.parent.postMessage({ action: "submitForm" }, "*");
            logDebug("postMessage sent to parent successfully.");
          } catch (error) {
            logDebug(`Error sending postMessage: ${error.message}`);
            countdownElement.textContent = "Error: Unable to notify parent form.";
          }
        }
      }, 1000);

      // Debug listener for messages coming to the widget
      window.addEventListener("message", (event) => {
        logDebug(`Received message from parent: ${JSON.stringify(event.data)}`);
      });

      // Add error handling for the form submission process
      try {
        const formElement = window.parent.document.getElementById("250137186711049");
        if (!formElement) {
          logDebug("Parent form not found. Ensure correct form ID.");
        } else {
          logDebug("Parent form found successfully.");
        }
      } catch (error) {
        logDebug(`Error accessing parent form: ${error.message}`);
      }
    });
  </script>
</body>
</html>
