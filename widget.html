<!DOCTYPE html>
<html>
    <head>
        <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    </head>
    <body>
        <div id="main">
            <h3>My Widget</h3>
            <p>Fetching hidden field values...</p>
            <div id="hidden-values-output"></div>
        </div>
        <script type="text/javascript">
            // Function to fetch and log hidden field values
            function fetchAndLogHiddenFields() {
                // Locate the widget-inputs-wrapper div
                const wrapper = document.querySelector('.widget-inputs-wrapper');

                if (wrapper) {
                    // Find all hidden inputs inside the wrapper
                    const hiddenFields = wrapper.querySelectorAll('input[type="hidden"]');
                    const hiddenValues = Array.from(hiddenFields).map(input => ({
                        name: input.name,
                        value: input.value,
                    }));

                    console.log("Hidden field values:", hiddenValues);

                    // Display the values in the widget
                    const outputDiv = document.getElementById('hidden-values-output');
                    outputDiv.innerHTML = `<pre>${JSON.stringify(hiddenValues, null, 2)}</pre>`;
                } else {
                    console.warn("No .widget-inputs-wrapper found in the widget DOM.");
                }
            }

            // Always subscribe to the ready event
            JFCustomWidget.subscribe('ready', function () {
                console.log("Widget is ready. Fetching hidden field values...");
                fetchAndLogHiddenFields();

                // Optionally, re-fetch values during form submission
                JFCustomWidget.subscribe('submit', function () {
                    console.log("Form submission detected. Re-fetching hidden field values...");
                    fetchAndLogHiddenFields();

                    // Send placeholder data to JotForm
                    const msg = {
                        valid: true,
                        value: { status: 'Submitted' },
                    };
                    JFCustomWidget.sendSubmit(msg);
                });
            });
        </script>
    </body>
</html>