<!DOCTYPE html>
<html>
    <head>
        <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    </head>
    <body>
        <div id="main">
            <h3>My Widget</h3>
            <p>Enter values in the fields below:</p>
            <label for="userInput1">Field 1:</label>
            <input type="text" id="userInput1" placeholder="Enter first value">
            <br><br>
            <label for="userInput2">Field 2:</label>
            <input type="text" id="userInput2" placeholder="Enter second value">
        </div>
        <script type="text/javascript">
            // Function to request the value of a hidden field from the parent document
            function requestHiddenFieldValue(qid, fieldName) {
                const message = {
                    type: "getHiddenFieldValue",
                    qid: qid,
                    fieldName: fieldName
                };
                // Send message to the parent document
                window.parent.postMessage(message, "*");
            }

            // Function to handle messages from the parent
            function handleParentResponse(event) {
                if (event.data.type === "hiddenFieldValueResponse") {
                    console.log(`Value of the hidden field: ${event.data.value}`);
                }
            }

            // Always subscribe to the ready event
            JFCustomWidget.subscribe("ready", function () {
                const settings = JFCustomWidget.getWidgetSettings();
                console.log("Widget settings:", settings);

                const qid = settings.qid;
                const field1 = settings.field1;

                if (qid && field1) {
                    console.log(`Requesting value of hidden field with QID: ${qid} and field name: ${field1}`);
                    requestHiddenFieldValue(qid, field1);
                } else {
                    if (!qid) console.error("QID is not defined in the widget settings.");
                    if (!field1) console.error("field1 is not defined in the widget settings.");
                }

                // Listen for messages from the parent
                window.addEventListener("message", handleParentResponse, false);
            });

            // Unsubscribe from events on unload
            window.addEventListener("unload", function () {
                window.removeEventListener("message", handleParentResponse);
            });
        </script>
    </body>
</html>